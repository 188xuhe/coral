apply plugin:'li-java'
apply plugin: 'maven-publish'
apply plugin: 'com.github.johnrengelman.shadow'

dependencies {
  // see :coral-hive build.gradle for why we add depedency this way
  compile files("${project(':coral-calcite').buildDir.absolutePath}/libs/coral-calcite-${version}.jar") {
    builtBy project(':coral-calcite').tasks.getByName('shadowJar')
  }

  compile spec.external.gson
  compile spec.external.'slf4j-api'
  compile spec.external.'slf4j-log4j12'

  testCompile project(path: ':coral-hive')

  testCompile (spec.product.hive.'hive-exec') {
    exclude group: 'org.apache.avro', module: 'avro-tools'
    // These exclusions are required to prevent duplicate classes since we include
    // shaded jar above
    exclude group: 'org.apache.calcite', module: 'calcite-core'
    exclude group: 'org.apache.calcite', module: 'calcite-avatica'
  }
}

// need to create a seprate fat shadowJar for dali-spark integration purpose
shadowJar {
  classifier = 'all'
  zip64 true
}

artifacts {
  archives shadowJar, jar, javadocJar, sourcesJar
}
